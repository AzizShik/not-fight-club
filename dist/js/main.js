!function(){"use strict";var e="",t=e+"assets/images/character_frodo.jpg";const a={player:{name:"",avatar:"",wins:0,loses:0,health:100,maxHealth:100,attack:10,attackZones:1,defendZones:2,critChance:.2,critMultiplier:1.5},battle:{playerAttack:[],playerDefend:[],enemyAttack:[],enemyDefend:[],log:[]},enemy:{},enemies:[{name:"Spider",avatar:e+"assets/images/enemy_spider.jpg",health:80,maxHealth:80,attack:12,critChance:.25,critMultiplier:1.5,attackZones:2,defendZones:1},{name:"Troll",avatar:e+"assets/images/enemy_troll.jpg",health:120,maxHealth:120,attack:8,critChance:.1,critMultiplier:2,attackZones:1,defendZones:3},{name:"Knight",avatar:e+"assets/images/enemy_knight.jpg",health:100,maxHealth:100,attack:10,critChance:.15,critMultiplier:1.5,attackZones:1,defendZones:2},{name:"Sauron",avatar:e+"assets/images/enemy_sauron.jpg",health:150,maxHealth:150,attack:15,critChance:.15,critMultiplier:1.5,attackZones:2,defendZones:2}]};function n(){localStorage.setItem("notFightClubGame",JSON.stringify(a))}function l(){const e=localStorage.getItem("notFightClubGame");if(e){const t=JSON.parse(e);Object.assign(a,t)}}var c=e+"assets/images/character_gandalf.jpg",o=e+"assets/images/character_aragorn.jpg",s=e+"assets/images/character_legolas.jpg",r=e+"assets/icons/cup.svg",i=e+"assets/icons/lose.svg";let d,m,p=null,_=null,u=null,h=!1;function g(){const e=document.querySelector("[data-battle_log]");if(a.enemy.name)a.battle.log.forEach(e=>{e.isCrit&&e.isBlocked?S(e):e.isBlocked?w(e):S(e)});else{const e=Math.floor(Math.random()*a.enemies.length);a.enemy=JSON.parse(JSON.stringify(a.enemies[e])),n()}E();const t=document.querySelector("[data-battle_controls_attack_btn]");t.disabled=!0;const l=document.querySelector("[data-battle_zone_attack]"),c=document.querySelector("[data-battle_zone_defence]"),o=l.querySelectorAll("input"),s=c.querySelectorAll("input");o.forEach(e=>{e.checked=!1}),s.forEach(e=>{e.checked=!1}),p&&l.removeEventListener("click",p),_&&c.removeEventListener("click",_);const d=a.player.attackZones;let m=[];p=e=>{const t=e.target;if("LABEL"===t.tagName)return;const a=l.querySelectorAll("input:checked").length;t.closest("[data-battle_zone_attack_radio]")&&(t.checked&&m.length<d&&m.push(t),t.checked||(t.checked=!1,m=m.filter(e=>e!=t)),a>d)&&(m.shift().checked=!1,m.push(t)),b()};const g=a.player.defendZones;let y=[];function b(){d===m.length&g===y.length?t.disabled=!1:t.disabled=!0}_=e=>{const t=e.target;if("LABEL"===t.tagName)return;const a=c.querySelectorAll("input:checked").length;t.closest("[data-battle_zone_defence_radio]")&&(t.checked&&y.length<g&&y.push(t),t.checked||(t.checked=!1,y=y.filter(e=>e!=t)),a>g)&&(y.shift().checked=!1,y.push(t)),b()},l.addEventListener("click",p),c.addEventListener("click",_),u&&t.removeEventListener("click",u),u=e=>{let t=[],l=[];m.forEach(e=>{t.push(e.dataset.battle_zone_attack_input)}),y.forEach(e=>{l.push(e.dataset.battle_zone_defence_input)}),a.battle.playerAttack.push(...t),a.battle.playerDefend.push(...l),function(){for(let e=0;a.battle.enemyAttack.length<a.enemy.attackZones;e++){const e=Math.floor(Math.random()*v.length);a.battle.enemyAttack.includes(v[e])||a.battle.enemyAttack.push(v[e])}}(),function(){for(let e=0;a.battle.enemyDefend.length<a.enemy.defendZones;e++){const e=Math.floor(Math.random()*v.length);a.battle.enemyDefend.includes(v[e])||a.battle.enemyDefend.push(v[e])}}(),n(),k(),a.battle.playerAttack=[],a.battle.playerDefend=[],a.battle.enemyAttack=[],a.battle.enemyDefend=[],n()},t.addEventListener("click",u);const v=["head","neck","body","belly","legs"];function k(){f("player"),a.enemy.health>=1&&f("enemy")}function f(e){let t,n;"player"===e?(t="player",n="enemy"):"enemy"===e&&(t="enemy",n="player");const l=t+"Attack",c=n+"Defend";a.battle[l].forEach(e=>{const l=a.player.critChance>Math.random(),o=l?Math.floor(a[t].attack*a[t].critMultiplier):a[t].attack,s="player"===t,r=s?"character":"enemy",i=s?"enemy":"character",d={attackerName:a[t].name,defenderName:a[n].name,attackZone:e,isCrit:l,damage:o,isBlocked:a.battle[c].includes(e),attackingCharacterSpan:r,defendingCharacterSpan:i,characterAttack:t,characterDefend:n};a.battle.log.push(d),d.isCrit&&d.isBlocked?S(d):d.isBlocked?w(d):S(d),function(e,t){a[e].health=a[e].health-t,E()}(d.characterDefend,o)})}function S(t){const{damage:a,characterDefend:n}=t,l=document.createElement("div");l.classList.add("battle__log-item"),l.innerHTML=function(e){const{attackerName:t,defenderName:a,attackZone:n,isCrit:l,damage:c,isBlocked:o,attackingCharacterSpan:s,defendingCharacterSpan:r}=e,i=n[0].toUpperCase()+n.slice(1);return l&&o?`\n            <span class="battle__log-item-${s} battle__log-item-span" data-battle_log_character_span>${t}</span>\n            attacked\n            <span class="battle__log-item-${r} battle__log-item-span" data-battle_log_enemy_span>${a}</span>\n            to\n            <span class="battle__log-item-zone battle__log-item-span" data-battle_log_zone_span>${i}</span>\n            <span class="battle__log-item-${r} battle__log-item-span" data-battle_log_enemy_span>${a}</span>\n            tried to block but <span class="battle__log-item-${s} battle__log-item-span" data-battle_log_character_span>${t}</span> was very lucky and crit his opponent for <span class="battle__log-item-damage battle__log-item-span" data-battle_log_zone_span>${c} damage</span>\n    `:l?`\n            <span class="battle__log-item-${s} battle__log-item-span" data-battle_log_character_span>${t}</span>\n            attacked\n            <span class="battle__log-item-${r} battle__log-item-span" data-battle_log_enemy_span>${a}</span>\n            to\n            <span class="battle__log-item-zone battle__log-item-span" data-battle_log_zone_span>${i}</span>\n            and crit\n            <span class="battle__log-item-damage battle__log-item-span" data-battle_log_zone_span>${c} damage</span>\n    `:`\n            <span class="battle__log-item-${s} battle__log-item-span" data-battle_log_character_span>${t}</span>\n            attacked\n            <span class="battle__log-item-${r} battle__log-item-span" data-battle_log_enemy_span>${a}</span>\n            to\n            <span class="battle__log-item-zone battle__log-item-span" data-battle_log_zone_span>${i}</span>\n            and deal\n            <span class="battle__log-item-damage battle__log-item-span" data-battle_log_zone_span>${c} damage</span>\n    `}(t),e.append(l),e.scrollTop=e.scrollHeight}function w(t){const{attackerName:a,defenderName:n,attackZone:l}=t,c=document.createElement("div");c.classList.add("battle__log-item"),c.innerHTML=function(e){const{attackerName:t,defenderName:a,attackZone:n,attackingCharacterSpan:l,defendingCharacterSpan:c}=e,o=n[0].toUpperCase()+n.slice(1);return`\n            <span class="battle__log-item-${l} battle__log-item-span" data-battle_log_character_span>${t}</span>\n            attacked\n            <span class="battle__log-item-${c} battle__log-item-span" data-battle_log_enemy_span>${a}</span>\n            to\n            <span class="battle__log-item-zone battle__log-item-span" data-battle_log_zone_span>${o}</span>\n            but <span class="battle__log-item-${c} battle__log-item-span" data-battle_log_enemy_span>${a}</span>\n            was able to <span class="battle__log-item-defend battle__log-item-span" data-battle_log_protect_span>protect</span>\n            his  <span class="battle__log-item-zone battle__log-item-span" data-battle_log_zone_span>${o}</span>\n    `}(t),e.append(c),e.scrollTop=e.scrollHeight}async function L(t){console.log(e.scrollHeight);const l=e.scrollTop;await F("./views/popup_results.html");const c=document.querySelector("[data-battle_log]");c&&(c.scrollTop=l),document.querySelector('[data-popup="results"]');const o=document.querySelector("[data-popup__title]"),s=document.createElement("img");s.classList.add("popup__results-icon"),"win"===t?(s.src=r,o.textContent="Congratulations with your win!",o.append(s),a.player.wins=a.player.wins+1,n(),N('[data-popup="results"]')):(s.src=i,o.textContent="Maybe next time",o.append(s),a.player.loses=a.player.loses+1,n(),N('[data-popup="results"]'))}function E(){const e=document.querySelector("[data-battle_character_avatar_img]"),t=document.querySelector("[data-battle_character_name]"),n=document.querySelector("[data-battle_character_current_health]"),l=document.querySelector("[data-battle_character_total_health]"),c=document.querySelector("[data-avatar_health_bg]"),o=document.querySelector("[data-enemy_health_bg]");e.src=a.player.avatar,t.textContent=a.player.name,a.player.health>=1?(n.textContent=a.player.health,c.style.width=100*a.player.health/a.player.maxHealth+"%"):(n.textContent=0,c.style.width="0%",h||(h=!0,L("lose"))),l.textContent=a.player.maxHealth;const s=document.querySelector("[data-battle_enemy_avatar_img]"),r=document.querySelector("[data-battle_enemy_name]"),i=document.querySelector("[data-battle_enemy_current_health]"),d=document.querySelector("[data-battle_enemy_total_health]");s.src=a.enemy.avatar,r.textContent=a.enemy.name,a.enemy.health>0?(i.textContent=a.enemy.health,o.style.width=100*a.enemy.health/a.enemy.maxHealth+"%"):(i.textContent=0,o.style.width="0%",h||(h=!0,L("win"))),d.textContent=a.enemy.maxHealth}k()}function y(){h=!1,a.player.health=a.player.maxHealth,a.enemy={},a.battle.log=[],document.querySelector("[data-battle_log]").textContent="",n()}async function b(){document.querySelector("[data-home_title_name]").textContent=a.player.name}async function v(){const e=document.querySelector("[data-register_btn]"),t=document.querySelector("[data-register_input]");d&&e&&e.removeEventListener("click",d),m&&t&&t.removeEventListener("input",m),d=async e=>{a.player.name=t.value,n(),await L(e),await b(),await C()},m=t=>{t.target.value.length>=1?e.disabled=!1:e.disabled=!0},e&&t&&(e.addEventListener("click",d),t.addEventListener("input",m))}let k=null,f=null;function S(){const e=document.querySelector("[data-settings_change_name]"),t=document.querySelector("[data-edit_change_name]"),l=document.querySelector("[data-settings_change_name_input]"),c=document.querySelector("[data-settings_change-name_current_name]");c.textContent=a.player.name;let o=a.player.name;k&&(t.removeEventListener("click",k),e.classList.remove("settings__change-name--active"),t.textContent="Edit",c.textContent=o),f&&l.removeEventListener("input",f),k=s=>{e.classList.contains("settings__change-name--active")?(e.classList.remove("settings__change-name--active"),t.textContent="Edit",c.textContent=o):(e.classList.add("settings__change-name--active"),t.textContent="Save",l.value=o),a.player.name=l.value.trim(),n()},f=e=>{const a=e.target;a.value?(t.disabled=!1,o=a.value.trim()):t.disabled=!0},t.addEventListener("click",k),l.addEventListener("input",f)}const w={"/register":"/views/register.html","/index.html":"/views/home.html","/":"/views/home.html","/home":"/views/home.html","/character":"/views/character.html","/settings":"/views/settings.html","/battle":"/views/battle.html"},L=async e=>{const t=e.target.dataset.link;window.history.pushState({},"",t),await q()},E=e=>{window.history.pushState({},"",e)},q=async()=>{console.log("works!");const e=window.location.pathname,t=w[e]||"/home";"/"===e&&(E("/home"),J()),"/index.html"===e&&(E("/home"),J()),w[e]||(E("/home"),J()),console.log(e),console.log(t);const a=await fetch(t).then(e=>e.text()),n=await fetch("./views/toolbar.html").then(e=>e.text());document.getElementById("root").innerHTML=a,document.getElementById("root").innerHTML+=n;let l={"/":b,"/index.html":b,"/home":b,"/register":v,"/character":O,"/settings":S,"/battle":g}[e];l?l():l=b,C()};async function C(){document.querySelectorAll("[data-link]").forEach(e=>{e.dataset.link,e.addEventListener("click",async t=>{await L(t);const a=e.dataset.page_btn;var n;document.querySelector("[data-page_title]").textContent=(n=a)[0].toUpperCase()+n.slice(1)})})}window.addEventListener("popstate",q);let x=null,$=null,M=null,z=null,H=null,Z=null,A=null;async function N(e){const l=document.querySelector("body"),r=document.querySelector(e);r.querySelector("[data-popup_container]").animate([{opacity:"0"},{opacity:"1"}],{duration:400,fill:"forwards"}),r.classList.add("popup--active"),l.classList.add("lock");const i=document.querySelector('[data-avatar_name="frodo"]'),d=document.querySelector('[data-avatar_name="gandalf"]'),m=document.querySelector('[data-avatar_name="aragorn"]'),p=document.querySelector('[data-avatar_name="legolas"]');x&&r.removeEventListener("click",x),$&&i&&i.removeEventListener("click",$),M&&d&&d.removeEventListener("click",M),z&&m&&m.removeEventListener("click",z),H&&p&&p.removeEventListener("click",H),x=t=>{const a=t.target;a.closest(".popup__container")||(D(e),'[data-popup="results"]'===e&&(y(),g(),n())),a.closest(".popup__close")&&(D(e),'[data-popup="results"]'===e&&(y(),g(),n()))},$=e=>{a.player.avatar=t,O(),n(),D('[data-popup="character_change"]')},M=e=>{a.player.avatar=c,O(),n(),D('[data-popup="character_change"]')},z=e=>{a.player.avatar=o,O(),n(),D('[data-popup="character_change"]')},H=e=>{a.player.avatar=s,O(),n(),D('[data-popup="character_change"]')},r.addEventListener("click",x),i&&d&&m&&p&&(i.addEventListener("click",$),d.addEventListener("click",M),m.addEventListener("click",z),p.addEventListener("click",H));const _=document.querySelector("[data-popup_results_btn_fight]"),u=document.querySelector("[data-popup_results_btn_character]");Z&&_&&_.removeEventListener("click",Z),A&&u&&u.removeEventListener("click",A),A=async e=>{D('[data-popup="results"'),y(),g(),await U("./views/character.html"),await F("./views/toolbar.html"),O(),n()},Z=e=>{D('[data-popup="results"'),y(),g(),n()},_&&u&&(_.addEventListener("click",Z),u.addEventListener("click",A))}function D(e){const t=document.querySelector(e),a=t.querySelector("[data-popup_container]").animate([{opacity:"1"},{opacity:"0"}],{duration:400,fill:"forwards"}),n=document.querySelector('[data-popup="character_change"]');a.addEventListener("finish",()=>{t.classList.remove("popup--active"),t.remove(),n&&O(),C()})}let B=null,T=null,j=null,I=null;function O(){document.querySelector('[data-popup="character_change"]');const e=document.querySelector("[data-character_edit_container]"),t=document.querySelector("[data-character_avatar]"),n=document.querySelector("[data-character_avatar_btn]"),l=document.querySelector("[data-character_avatar_img]"),c=document.querySelector("[data-character_name]"),o=document.querySelector("[data-result_wins]"),s=document.querySelector("[data-result_loses]");l.src=a.player.avatar,c.textContent=a.player.name,o.textContent=a.player.wins,s.textContent=a.player.loses;const r="character__avatar-edit-container--active";e.classList.remove(r),B&&t.removeEventListener("mouseover",B),T&&t.removeEventListener("mouseout",T),j&&e.removeEventListener("click",j),I&&n.removeEventListener("click",I),B=t=>{e.classList.add(r)},T=t=>{e.classList.remove(r)},j=async e=>{await F("./views/popup_character.html"),await N('[data-popup="character_change"]')},I=async e=>{await F("./views/popup_character.html"),await N('[data-popup="character_change"]')},t.addEventListener("mouseover",B),t.addEventListener("mouseout",T),e.addEventListener("click",j),n.addEventListener("click",I)}async function J(){l(),a.player.name?(await U("./views/home.html"),await F("./views/toolbar.html"),await C(),await b(),q()):(a.player.avatar=t,await U("./views/register.html"),await v(),E("/register"))}async function U(e){const t=await fetch(e).then(e=>e.text());document.getElementById("root").innerHTML=t}async function F(e){const t=await fetch(e).then(e=>e.text());document.getElementById("root").innerHTML+=t}window.addEventListener("DOMContentLoaded",()=>{l(),J()})}();
//# sourceMappingURL=main.js.map